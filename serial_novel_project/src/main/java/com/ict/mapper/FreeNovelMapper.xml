<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<mapper namespace="com.ict.mapper.FreeNovelMapper">
	<sql id="search">
	<!-- 동적 쿼리문이 들어올 자리  -->
	<if test="searchType != null">
		<if test="searchType == 't'.toString()">
			(TITLE like '%'||#{keyword}||'%') AND
		</if>
		<if test="searchType == 'c'.toString()">
			(CONTENT like '%'||#{keyword}||'%') AND
		</if>
		<if test="searchType == 'w'.toString()">
			(WRITER like '%'||#{keyword}||'%') AND
		</if>
		<if test="searchType == 'tc'.toString()">
		   ((TITLE like '%'||#{keyword}||'%')
		    	OR
			(CONTENT like '%'||#{keyword}||'%')) AND
		</if>
		<if test="searchType == 'cw'.toString()">
		   ((CONTENT like '%'||#{keyword}||'%')
		    	OR
			(WRITER like '%'||#{keyword}||'%')) AND
		</if>
		<if test="searchType == 'tcw'.toString()">
		   ((TITLE like '%'||#{keyword}||'%')
		    	OR
		    (CONTENT like '%'||#{keyword}||'%')
		    	OR
			(WRITER like '%'||#{keyword}||'%')) AND
		</if>
		
	</if>
	</sql>
	<select id="getList" resultType="com.ict.domain.FreeNovelVO">
	<![CDATA[ 
	SELECT * FROM 
	(SELECT /*+ INDEX_DESC(free_tbl free_num) */
	rownum rn, free_tbl.* FROM free_tbl WHERE 
	
	]]>
	<include refid="search"></include>
	
	<![CDATA[
	
	rownum <= #{pageEnd})
	WHERE rn > #{pageStart}
	
	]]>
	</select>
	
	<select id="select" resultType="com.ict.domain.FreeNovelVO">
	SELECT * FROM free_tbl WHERE free_num = #{free_num} 
	</select>
	
	<insert id="insert">
		INSERT INTO free_tbl (free_num, novel_num, free_snum, free_title, free_content) VALUES
                        (free_num.nextval, #{novel_num},#{free_snum},#{free_title},#{free_content});
                         
	</insert>
	
	<delete id="delete">
		DELETE FROM free_tbl WHERE free_num=#{free_num}
		
	</delete>
	<update id="update">
	UPDATE free_tbl SET free_content=#{free_content}, free_mdate=SYSDATE 
	WHERE free_num=#{free_num}
		
	</update>
	<select id="countPageNum" resultType="int">
	<![CDATA[ 
	SELECT count(*) FROM free_tbl WHERE
	
	]]> 
		<include refid="search"></include>
	<![CDATA[
	free_num > 0
	]]>
	</select>
	
	</mapper>